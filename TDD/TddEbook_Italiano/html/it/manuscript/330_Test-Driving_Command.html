<!DOCTYPE html>

<html lang="it" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Logica dell&#39;applicazione test-driving &#8212; Documentazione TDD 2025 </title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=ad698211"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/translations.js?v=45930005"></script>
    <link rel="index" title="Indice" href="../genindex.html" />
    <link rel="search" title="Cerca" href="../search.html" />
    <link rel="next" title="Oggetti valore nel test-driving" href="340_Test-Driving_Value_object.html" />
    <link rel="prev" title="Creazione di oggetti &#34;test-driving&#34; -- una retrospettiva" href="320_Test_Driving_Factories_retrospective.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="test-driving-application-logic">
<h1>Logica dell'applicazione test-driving<a class="headerlink" href="#test-driving-application-logic" title="Link to this heading">¶</a></h1>
<p><strong>Johnny:</strong> Qual è il prossimo elemento della nostra lista dei TODO?</p>
<p><strong>Benjamin:</strong> Abbiamo...</p>
<ul class="simple">
<li><p>un unico promemoria per modificare il nome della factory che crea le istanze <code class="docutils literal notranslate"><span class="pre">ReservationInProgress</span></code>.</p></li>
<li><p>Inoltre, abbiamo due punti in cui una <code class="docutils literal notranslate"><span class="pre">NotImplementedException</span></code> suggerisce che c'è ancora qualcosa da implementare.</p>
<ul>
<li><p>La prima è la factory menzionata.</p></li>
<li><p>La seconda è la classe <code class="docutils literal notranslate"><span class="pre">NewReservationCommand</span></code> che abbiamo scoperto scrivendo uno Statement per la factory.</p></li>
</ul>
</li>
</ul>
<p><strong>Johnny:</strong> Facciamo la <code class="docutils literal notranslate"><span class="pre">NewReservationCommand</span></code>. Sospetto che la complessità che abbiamo inserito nel controller ci ripagherà e saremo in grado di testare la logica dei comandi alle nostre condizioni.</p>
<p><strong>Benjamin:</strong> Non vedo l'ora di vederlo. Ecco il codice attuale del comando:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">NewReservationCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ReservationCommand</span>
<span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Johnny:</strong> Quindi abbiamo la firma della classe e del metodo. Sembra che possiamo usare la consueta strategia di scrivere un nuovo Statement.</p>
<p><strong>Benjamin:</strong> Intendi &quot;inizia invocando un metodo se ne hai uno&quot;? Ho pensato la stessa cosa. Fammi provare.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">NewReservationCommandSpecification</span>
<span class="p">{</span>
<span class="w"> </span><span class="na">[Fact]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span>
<span class="w"> </span><span class="n">ShouldXXXXXXXXXXX</span><span class="p">()</span><span class="w"> </span><span class="c1">//TODO change the name</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">//GIVEN</span>
<span class="w">  </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewReservationCommand</span><span class="p">();</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1">//WHEN</span>
<span class="w">  </span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="w"> </span>
<span class="w">  </span><span class="c1">//THEN</span>
<span class="w">  </span><span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="k">false</span><span class="p">);</span><span class="w"> </span><span class="c1">//TODO unfinished</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questo è quello che potrei scrivere quasi senza pensarci. Ho semplicemente preso le parti in nostro possesso e le ho inserite nello Statement.</p>
<p>Manca ancora l'asserzione - quella che abbiamo è semplicemente un segnaposto. Questo è il momento giusto per pensare a cosa dovrebbe accadere quando eseguiamo il comando.</p>
<p><strong>Johnny:</strong> Per ottenere il comportamento previsto, dobbiamo guardare indietro ai dati di input per l'intero caso d'uso. L'abbiamo passato alla factory e ce ne siamo dimenticati. Quindi, solo come promemoria - ecco come appare:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ReservationRequestDto</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">TrainId</span><span class="p">;</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="n">SeatCount</span><span class="p">;</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="nf">ReservationRequestDto</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">,</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="n">seatCount</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">TrainId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainId</span><span class="p">;</span>
<span class="w">    </span><span class="n">SeatCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seatCount</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La prima parte è l'ID del treno -- dice su quale treno dovremmo prenotare i posti. Quindi dobbiamo in qualche modo scegliere un treno dalla flotta per la prenotazione. Quindi, su quel treno, dobbiamo prenotare tutti i posti richiesti dal cliente. Il numero di posti richiesto è la seconda parte della richiesta dell'utente.</p>
<p><strong>Benjamin:</strong> Non aggiorneremo i dati in una sorta di memoria persistente? Dubito che la compagnia ferroviaria vorrebbe che la prenotazione scomparisse al riavvio dell'applicazione.</p>
<p><strong>Johnny:</strong> Sì, dobbiamo comportarci come se ci fosse una sorta di persistenza.</p>
<p>Considerato tutto quanto sopra, posso vedere due nuovi ruoli nel nostro scenario:</p>
<ol class="arabic simple">
<li><p>Una flotta - da cui prendiamo il treno e dove salviamo le nostre modifiche</p></li>
<li><p>Un treno - che gestirà la logica della prenotazione.</p></li>
</ol>
<p>Entrambi questi ruoli devono essere modellati come mock, perché mi aspetto che svolgano un ruolo attivo in questo scenario.</p>
<p>Ampliamo il nostro Statement  con le nostre scoperte.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="na">[Fact]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span>
<span class="n">ShouldReserveSeatsInSpecifiedTrainWhenExecuted</span><span class="p">()</span>
<span class="p">{</span>
<span class="w"> </span><span class="c1">//GIVEN</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewReservationCommand</span><span class="p">(</span><span class="n">fleet</span><span class="p">);</span>
<span class="w"> </span>
<span class="w"> </span><span class="n">fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">trainId</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>

<span class="w"> </span><span class="c1">//WHEN</span>
<span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>

<span class="w"> </span><span class="c1">//THEN</span>
<span class="w"> </span><span class="n">Received</span><span class="p">.</span><span class="n">InOrder</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">);</span>
<span class="w">  </span><span class="n">fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Benjamin:</strong> Vedo che mancano molte cose qui. Ad esempio, non abbiamo le variabili <code class="docutils literal notranslate"><span class="pre">train</span></code> e <code class="docutils literal notranslate"><span class="pre">fleet</span></code>.</p>
<p><strong>Johnny:</strong> Abbiamo creato una necessità per loro. Penso che ora possiamo tranquillamente introdurli nello Statement.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="na">[Fact]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span>
<span class="n">ShouldReserveSeatsInSpecifiedTrainWhenExecuted</span><span class="p">()</span>
<span class="p">{</span>
<span class="w"> </span><span class="c1">//GIVEN</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">fleet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">TrainFleet</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">ReservableTrain</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewReservationCommand</span><span class="p">(</span><span class="n">fleet</span><span class="p">);</span>
<span class="w"> </span>
<span class="w"> </span><span class="n">fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">trainId</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>

<span class="w"> </span><span class="c1">//WHEN</span>
<span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>

<span class="w"> </span><span class="c1">//THEN</span>
<span class="w"> </span><span class="n">Received</span><span class="p">.</span><span class="n">InOrder</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">);</span>
<span class="w">  </span><span class="n">fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Benjamin:</strong> Vedo due nuovi tipi: <code class="docutils literal notranslate"><span class="pre">TrainFleet</span></code> e <code class="docutils literal notranslate"><span class="pre">ReservableTrain</span></code>.</p>
<p><strong>Johnny:</strong> Simboleggiano i ruoli che abbiamo appena scoperto.</p>
<p><strong>Benjamin:</strong> Inoltre, ho notato che hai utilizzato <code class="docutils literal notranslate"><span class="pre">Received.InOrder()</span></code> da NSubstitute per specificare l'ordine di chiamata previsto.</p>
<p><strong>Johnny:</strong> Questo perché dobbiamo prenotare i posti prima di aggiornare le informazioni in una sorta di archivio. Se sbagliassimo l'ordine, il resto potrebbe andare perso.</p>
<p><strong>Benjamin:</strong> Ma in questo Statement manca qualcosa. Ho appena esaminato gli output che i nostri utenti si aspettano:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ReservationDto</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">TrainId</span><span class="p">;</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ReservationId</span><span class="p">;</span>
<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TicketDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PerSeatTickets</span><span class="p">;</span>

<span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="nf">ReservationDto</span><span class="p">(</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">,</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">TicketDto</span><span class="o">&gt;</span><span class="w"> </span><span class="n">perSeatTickets</span><span class="p">,</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="n">reservationId</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">TrainId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainId</span><span class="p">;</span>
<span class="w">    </span><span class="n">PerSeatTickets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">perSeatTickets</span><span class="p">;</span>
<span class="w">    </span><span class="n">ReservationId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationId</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sono molte le informazioni che dobbiamo restituire all'utente. Come lo faremo esattamente quando la chiamata a <code class="docutils literal notranslate"><span class="pre">train.ReserveSeats(seatCount)</span></code> che hai inventato non dovrebbe restituire nulla?</p>
<p><strong>Johnny:</strong> Ah, sì, quasi dimenticavo - abbiamo l'istanza <code class="docutils literal notranslate"><span class="pre">ReservationInProgress</span></code> che abbiamo passato alla factory, ma non ancora al comando, giusto? La <code class="docutils literal notranslate"><span class="pre">ReservationInProgress</span></code> è stato inventata proprio per questo scopo - raccogliere le informazioni necessarie per produrre un risultato dell'intera operazione. Vorrei solo aggiornare rapidamente lo Statement:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="na">[Fact]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span>
<span class="n">ShouldReserveSeatsInSpecifiedTrainWhenExecuted</span><span class="p">()</span>
<span class="p">{</span>
<span class="w"> </span><span class="c1">//GIVEN</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">fleet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">TrainFleet</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">ReservableTrain</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any</span><span class="p">.</span><span class="n">Instance</span><span class="o">&lt;</span><span class="n">ReservationInProgress</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewReservationCommand</span><span class="p">(</span><span class="n">fleet</span><span class="p">,</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="w"> </span>
<span class="w"> </span><span class="n">fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">trainId</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>

<span class="w"> </span><span class="c1">//WHEN</span>
<span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>

<span class="w"> </span><span class="c1">//THEN</span>
<span class="w"> </span><span class="n">Received</span><span class="p">.</span><span class="n">InOrder</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">,</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="w">  </span><span class="n">fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ora il metodo <code class="docutils literal notranslate"><span class="pre">ReserveSeats</span></code> accetta <code class="docutils literal notranslate"><span class="pre">reservationInProgress</span></code>.</p>
<p><strong>Benjamin:</strong> Perché stai passando il metodo <code class="docutils literal notranslate"><span class="pre">reservationInProgress</span></code> al metodo <code class="docutils literal notranslate"><span class="pre">ReserveSeats</span></code>?</p>
<p><strong>Johnny:</strong> Il comando non contiene le informazioni necessarie per compilare <code class="docutils literal notranslate"><span class="pre">reservationInProgress</span></code> una volta che la prenotazione ha avuto esito positivo. Dobbiamo rimandarlo alle implementazioni di <code class="docutils literal notranslate"><span class="pre">ReservableTrain</span></code> per decidere ulteriormente il posto migliore per farlo.</p>
<p><strong>Benjamin:</strong> Capisco. Osservando di nuovo lo Statement, mancano altre due variabili -- <code class="docutils literal notranslate"><span class="pre">trainId</span></code> e <code class="docutils literal notranslate"><span class="pre">seatCount</span></code> -- e non solo le loro definizioni, ma non le passiamo affatto al comando. Sono presenti solo nelle nostre assunzioni ed &quot;expectation&quot;.</p>
<p><strong>Johnny:</strong> Esatto, lasciami correggere.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="na">[Fact]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span>
<span class="n">ShouldReserveSeatsInSpecifiedTrainWhenExecuted</span><span class="p">()</span>
<span class="p">{</span>
<span class="w"> </span><span class="c1">//GIVEN</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">fleet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">TrainFleet</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">ReservableTrain</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">trainId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any</span><span class="p">.</span><span class="n">String</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">seatCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any</span><span class="p">.</span><span class="n">UnsignedInt</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any</span><span class="p">.</span><span class="n">Instance</span><span class="o">&lt;</span><span class="n">ReservationInProgress</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewReservationCommand</span><span class="p">(</span>
<span class="w">   </span><span class="n">trainId</span><span class="p">,</span>
<span class="w">   </span><span class="n">seatCount</span><span class="p">,</span>
<span class="w">   </span><span class="n">fleet</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="w"> </span>
<span class="w"> </span><span class="n">fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">trainId</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>

<span class="w"> </span><span class="c1">//WHEN</span>
<span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>

<span class="w"> </span><span class="c1">//THEN</span>
<span class="w"> </span><span class="n">Received</span><span class="p">.</span><span class="n">InOrder</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">,</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="w">  </span><span class="n">fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="w"> </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Benjamin:</strong> Perché <code class="docutils literal notranslate"><span class="pre">seatCount</span></code> è un <code class="docutils literal notranslate"><span class="pre">uint</span></code>?</p>
<p><strong>Johnny:</strong> Cercalo nel DTO: lì c'è un <code class="docutils literal notranslate"><span class="pre">uint</span></code>. Non vedo la necessità di ridefinirlo qui.</p>
<p><strong>Benjamin:</strong> Bene, ma per quanto riguarda <code class="docutils literal notranslate"><span class="pre">trainId</span></code> - è una <code class="docutils literal notranslate"><span class="pre">string</span></code>. Non mi hai detto che dobbiamo utilizzare <em>oggetti valore</em> relativi al dominio per concetti come questo?</p>
<p><strong>Johnny:</strong> Sì, effettueremo il refactoring di questa <code class="docutils literal notranslate"><span class="pre">string</span></code> in un <em>oggetto valore</em>, soprattutto perché abbiamo il requisito che i confronti degli ID dei treni non facciano distinzione tra maiuscole e minuscole. Ma prima voglio finire questa istruzione prima di definire e specificare un nuovo tipo. Tuttavia, è meglio lasciare una nota TODO per tornarci più tardi:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">trainId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Any</span><span class="p">.</span><span class="n">String</span><span class="p">();</span><span class="w"> </span><span class="c1">//TODO extract value object</span>
</pre></div>
</div>
<p>Fin qui tutto bene, penso che abbiamo una dichiarazione completa. Vuoi prendere la tastiera?</p>
<p><strong>Benjamin:</strong> Grazie. Iniziamo allora a implementarlo. Innanzitutto, inizierò con queste due interfacce:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="w"> </span><span class="n">fleet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">TrainFleet</span><span class="o">&gt;</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Substitute</span><span class="p">.</span><span class="n">For</span><span class="o">&lt;</span><span class="n">ReservableTrain</span><span class="o">&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>Non esistono, quindi questo codice non viene compilato. Posso facilmente risolvere questo problema creando le interfacce nel codice di produzione:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">TrainFleet</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ReservableTrain</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ora per questa parte:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewReservationCommand</span><span class="p">(</span>
<span class="w">   </span><span class="n">trainId</span><span class="p">,</span>
<span class="w">   </span><span class="n">seatCount</span><span class="p">,</span>
<span class="w">   </span><span class="n">fleet</span><span class="p">,</span><span class="w"> </span>
<span class="w">   </span><span class="n">reservationInProgress</span><span class="p">);</span>
</pre></div>
</div>
<p>Non viene compilato perché il comando non accetta ancora alcun parametro del costruttore. Creiamo quindi un costruttore di adattamento:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">NewReservationCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ReservationCommand</span>
<span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">NewReservationCommand</span><span class="p">(</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint</span><span class="w"> </span><span class="n">seatCount</span><span class="p">,</span>
<span class="w">  </span><span class="n">TrainFleet</span><span class="w"> </span><span class="n">fleet</span><span class="p">,</span>
<span class="w">  </span><span class="n">ReservationInProgress</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>

<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il nostro Statement ora può invocare questo costruttore, ma abbiamo guastato <code class="docutils literal notranslate"><span class="pre">TicketOfficeCommandFactory</span></code> che crea anche un'istanza <code class="docutils literal notranslate"><span class="pre">NewReservationCommand</span></code>. Guarda:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="n">ReservationCommand</span><span class="w"> </span><span class="nf">CreateNewReservationCommand</span><span class="p">(</span>
<span class="w">    </span><span class="n">ReservationRequestDto</span><span class="w"> </span><span class="n">requestDto</span><span class="p">,</span>
<span class="w">    </span><span class="n">ReservationInProgress</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">//Stopped compiling:</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NewReservationCommand</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p><strong>Johnny:</strong> Dobbiamo correggere la factory nello stesso modo in cui abbiamo dovuto correggere la &quot;composition root&quot; durante il test-driving del controller. Vediamo... Ecco:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="n">ReservationCommand</span><span class="w"> </span><span class="nf">CreateNewReservationCommand</span><span class="p">(</span>
<span class="w">    </span><span class="n">ReservationRequestDto</span><span class="w"> </span><span class="n">requestDto</span><span class="p">,</span>
<span class="w">    </span><span class="n">ReservationInProgress</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NewReservationCommand</span><span class="p">(</span>
<span class="w">   </span><span class="n">requestDto</span><span class="p">.</span><span class="n">TrainId</span><span class="p">,</span>
<span class="w">   </span><span class="n">requestDto</span><span class="p">.</span><span class="n">SeatCount</span><span class="p">,</span>
<span class="w">   </span><span class="k">new</span><span class="w"> </span><span class="nf">TodoTrainFleet</span><span class="p">(),</span><span class="w"> </span><span class="c1">// TODO fix name and scope</span>
<span class="w">   </span><span class="n">reservatonInProgress</span>
<span class="w">   </span><span class="p">);</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p><strong>Benjamin:</strong> Il passaggio dei parametri mi sembra semplice, tranne <code class="docutils literal notranslate"><span class="pre">TodoTrainFleet()</span></code> -- so già che il nome è un segnaposto - hai già fatto qualcosa del genere prima. Ma per quanto riguarda il ciclo di vita dello &quot;scope&quot;?</p>
<p><strong>Johnny:</strong> È anch'esso un segnaposto. Per ora, voglio soddisfare il compilatore, mantenendo allo stesso tempo veri gli Statement esistenti e introducendo una nuova classe -- <code class="docutils literal notranslate"><span class="pre">TodoTrainFleet</span></code> --  che porterà nuovi elementi nella nostra lista TODO.</p>
<p><strong>Benjamin:</strong> Nuovi articoli TODO?</p>
<p><strong>Johnny:</strong> Sì. Look -- il tipo <code class="docutils literal notranslate"><span class="pre">TodoTrainFleet</span></code> non esiste ancora. Lo creerò ora:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TodoTrainFleet</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Questo non corrisponde alla firma del costruttore del comando, che prevede un <code class="docutils literal notranslate"><span class="pre">TrainFleet</span></code>, quindi devo fare in modo che <code class="docutils literal notranslate"><span class="pre">TodoTrainFleet</span></code> implementi questa interfaccia:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TodoTrainFleet</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TrainFleet</span>
<span class="p">{</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Ora sono costretto a implementare i metodi dall'interfaccia <code class="docutils literal notranslate"><span class="pre">TrainFleet</span></code>. Anche se questa interfaccia non definisce ancora alcun metodo, ne abbiamo già scoperti due nel nostro Statement, quindi bisognerà presto ottenerli per accontentare il compilatore. Entrambi conterranno il codice che lancia <code class="docutils literal notranslate"><span class="pre">NotImplementedException</span></code>, che verrà inserito nell'elenco TODO.</p>
<p><strong>Benjamin:</strong> Capisco. Ad ogni modo, la factory compila di nuovo. Ci resta ancora questa parte dello Statement:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="n">fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">trainId</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>

<span class="w"> </span><span class="c1">//WHEN</span>
<span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>

<span class="w"> </span><span class="c1">//THEN</span>
<span class="w"> </span><span class="n">Received</span><span class="p">.</span><span class="n">InOrder</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">,</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="w">  </span><span class="n">fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p><strong>Johnny:</strong> Si tratta solo di introdurre tre metodi. Puoi gestirlo.</p>
<p><strong>Benjamin:</strong> Grazie. La prima riga è <code class="docutils literal notranslate"><span class="pre">fleet.Pick(trainId).Returns(train)</span></code>. Genererò semplicemente il metodo <code class="docutils literal notranslate"><span class="pre">Pick</span></code> utilizzando il mio IDE:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">TrainFleet</span>
<span class="p">{</span>
<span class="w"> </span><span class="n">ReservableTrain</span><span class="w"> </span><span class="nf">Pick</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>L'interfaccia <code class="docutils literal notranslate"><span class="pre">TrainFleet</span></code> è implementata dal <code class="docutils literal notranslate"><span class="pre">TodoTrainFleet</span></code> di cui abbiamo parlato qualche minuto fa. È necessario implementare anche il metodo <code class="docutils literal notranslate"><span class="pre">Pick</span></code> altrimenti non verrà compilato:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TodoTrainFleet</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TrainFleet</span>
<span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ReservableTrain</span><span class="w"> </span><span class="nf">Pick</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Questa <code class="docutils literal notranslate"><span class="pre">NotImplementedException</span></code> verrà inserita nel nostro elenco TODO proprio come hai menzionato. Carino!</p>
<p>Poi arriva la riga successiva dallo Statement: <code class="docutils literal notranslate"><span class="pre">train.ReserveSeats(seatCount,</span> <span class="pre">reservationInProgress)</span></code> e ne genererò una firma del metodo come dalla riga precedente.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ReservableTrain</span>
<span class="p">{</span>
<span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReserveSeats</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="n">seatCount</span><span class="p">,</span><span class="w"> </span><span class="n">ReservationInProgress</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>L'interfaccia <code class="docutils literal notranslate"><span class="pre">ReservableTrain</span></code> non ha alcuna implementazione finora, quindi non c'è più nulla a che fare con questo metodo.</p>
<p>L'ultima riga: <code class="docutils literal notranslate"><span class="pre">fleet.UpdateInformationAbout(train)</span></code> che deve essere aggiunta all'interfaccia <code class="docutils literal notranslate"><span class="pre">TrainFleet</span></code>:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">TrainFleet</span>
<span class="p">{</span>
<span class="w"> </span><span class="n">ReservableTrain</span><span class="w"> </span><span class="nf">Pick</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">);</span>
<span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateInformationAbout</span><span class="p">(</span><span class="n">ReservableTrain</span><span class="w"> </span><span class="n">train</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Inoltre, dobbiamo definire questo metodo nella classe <code class="docutils literal notranslate"><span class="pre">TodoTrainFleet</span></code>:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TodoTrainFleet</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TrainFleet</span>
<span class="p">{</span>
<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ReservableTrain</span><span class="w"> </span><span class="nf">Pick</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateInformationAbout</span><span class="p">(</span><span class="n">ReservableTrain</span><span class="w"> </span><span class="n">train</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Johnny:</strong> Anche questa <code class="docutils literal notranslate"><span class="pre">NotImplementedException</span></code> verrà aggiunta all'elenco delle cose da fare, quindi potremo rivisitarla in seguito. Sembra che lo Statement venga compilato e, come previsto, sia falso, ma non per la ragione giusta.</p>
<p><strong>Benjamin:</strong> Vediamo... sì, viene lanciata una <code class="docutils literal notranslate"><span class="pre">NotImplementedException</span></code> dal metodo <code class="docutils literal notranslate"><span class="pre">Execute()</span></code> del comando.</p>
<p><strong>Johnny:</strong> Liberiamocene.</p>
<p><strong>Benjamin:</strong> Certo. Ho rimosso <code class="docutils literal notranslate"><span class="pre">throw</span></code> e ora il metodo è vuoto:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>Lo Statement  ora è falso perché le chiamate previste non corrispondono.</p>
<p><strong>Johnny:</strong> Ciò significa che siamo finalmente pronti a codificare alcuni comportamenti nella classe <code class="docutils literal notranslate"><span class="pre">NewReservationCommand</span></code>. Innanzitutto, assegniamo tutti i parametri del costruttore ai campi -- ne avremo bisogno.</p>
<p><strong>Benjamin:</strong> Ecco:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">NewReservationCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ReservationCommand</span>
<span class="p">{</span>
<span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">_trainId</span><span class="p">;</span>
<span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="n">_seatCount</span><span class="p">;</span>
<span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">TraingFleet</span><span class="w"> </span><span class="n">_fleet</span><span class="p">;</span>
<span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ReservationInProgress</span><span class="w"> </span><span class="n">_reservationInProgress</span><span class="p">;</span>

<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">NewReservationCommand</span><span class="p">(</span>
<span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="n">trainId</span><span class="p">,</span>
<span class="w">  </span><span class="kt">uint</span><span class="w"> </span><span class="n">seatCount</span><span class="p">,</span>
<span class="w">  </span><span class="n">TrainFleet</span><span class="w"> </span><span class="n">fleet</span><span class="p">,</span>
<span class="w">  </span><span class="n">ReservationInProgress</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">)</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">_trainId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainId</span><span class="p">;</span>
<span class="w">  </span><span class="n">_seatCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seatCount</span><span class="p">;</span>
<span class="w">  </span><span class="n">_fleet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fleet</span><span class="p">;</span>
<span class="w">  </span><span class="n">_reservationInProgress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>

<span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w"> </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Johnny:</strong> Ora aggiungiamo le chiamate previste nello Statement, ma nell'ordine opposto.</p>
<p><strong>Benjamin:</strong> Per assicurarsi che l'ordine sia asserito correttamente nello Statement?</p>
<p><strong>Johnny:</strong> Esattamente.</p>
<p><strong>Benjamin:</strong> Ok.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="p">{</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">_trainId</span><span class="p">);</span>
<span class="w"> </span><span class="n">_fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="w"> </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Lo Statement è ancora falso, questa volta a causa dell'ordine di chiamata sbagliato. Ora che abbiamo la conferma che dobbiamo effettuare le chiamate nell'ordine giusto, sospetto che tu voglia che lo inverta, quindi...</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="p">{</span>
<span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_fleet</span><span class="p">.</span><span class="n">Pick</span><span class="p">(</span><span class="n">_trainId</span><span class="p">);</span>
<span class="w"> </span><span class="n">train</span><span class="p">.</span><span class="n">ReserveSeats</span><span class="p">(</span><span class="n">seatCount</span><span class="p">,</span><span class="w"> </span><span class="n">reservationInProgress</span><span class="p">);</span>
<span class="w">  </span><span class="n">_fleet</span><span class="p">.</span><span class="n">UpdateInformationAbout</span><span class="p">(</span><span class="n">train</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Johnny:</strong> Esattamente. Lo Statement ora è &quot;true&quot;. Congratulazioni!</p>
<p><strong>Benjamin:</strong> Ora che guardo questo codice, non è protetto da alcun tipo di eccezione che potrebbe essere generata da <code class="docutils literal notranslate"><span class="pre">_fleet</span></code> o da <code class="docutils literal notranslate"><span class="pre">train</span></code>.</p>
<p><strong>Johnny:</strong> Aggiungilo alla lista TODO - prima o poi dovremo occuparcene. Per ora, prendiamoci una pausa.</p>
<section id="summary">
<h2>Riepilogo<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h2>
<p>In questo capitolo, Johnny e Benjamin hanno utilizzato nuovamente il rilevamento (discovery) dell'interfaccia. Hanno utilizzato alcune ragioni tecniche e altre legate al dominio per creare la necessità di nuove astrazioni e progettare i loro protocolli di comunicazione. Queste astrazioni sono state poi inserite nello Statement.</p>
<p>Ricordrsi che Johnny e Benjamin hanno prolungato lo sforzo durante il test-driving del controller. Questo lavoro ora ha dato i suoi frutti - erano liberi di modellare astrazioni per lo più al di fuori dei vincoli imposti da un framework specifico.</p>
<p>Questo capitolo non ha una retrospettiva complementare come i precedenti. La maggior parte delle cose interessanti che sono accadute qui sono già state spiegate.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">TDD</a></h1>








<h3>Navigazione</h3>
<p class="caption" role="heading"><span class="caption-text">Contenuti:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cover.html">Titolo</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Premessa</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="010_Dedication.html">Premessa</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Dedication.html#dedications">Dediche</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Thanks.html">Grazie!</a></li>
<li class="toctree-l1"><a class="reference internal" href="017_CodeExamples.html">I codici di esempio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parte 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="020_Part1Marker.html">Parte 1: Solo le nozioni di base</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_Motivations.html">Motivazione: il primo passo per imparare il TDD</a></li>
<li class="toctree-l1"><a class="reference internal" href="040_Three_Essential_Tools.html"><span class="xref myst">Gli strumenti essenziali</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="050_Its_Not_a_Test.html">Non è (solo) un test</a></li>
<li class="toctree-l1"><a class="reference internal" href="060_Statement_First_Programming.html">La programmazione Statement-first</a></li>
<li class="toctree-l1"><a class="reference internal" href="070_Practicing_What_We_Already_Learned.html">Mettere in pratica ciò che abbiamo già imparato</a></li>
<li class="toctree-l1"><a class="reference internal" href="080_Sorting_out_the_bits.html">Facciamo un po' d'ordine</a></li>
<li class="toctree-l1"><a class="reference internal" href="090_How_to_start.html">Come iniziare?</a></li>
<li class="toctree-l1"><a class="reference internal" href="100_Analysis_In_TDD.html">In che modo il TDD riguarda l'analisi e cosa significa &quot;GIVEN-WHEN-THEN&quot;?</a></li>
<li class="toctree-l1"><a class="reference internal" href="110_What_is_the_scope_of_a_Statement_in_TDD.html">Qual è lo scopo di uno Statement a livello di unità in TDD?</a></li>
<li class="toctree-l1"><a class="reference internal" href="120_Constrained_Non_Determinism.html">Sviluppare uno stile TDD e Non-Determinismo Vincolato</a></li>
<li class="toctree-l1"><a class="reference internal" href="130_Boundaries.html">Specificare i confini e le condizioni funzionali</a></li>
<li class="toctree-l1"><a class="reference internal" href="140_Triangulation.html">Guidare l'implementazione dalle Specifiche</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parte 2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="150_Part2Marker.html">Parte 2: Il Mondo Object-Oriented</a></li>
<li class="toctree-l1"><a class="reference internal" href="160_Composable_Design.html">La Componibilità degli Oggetti</a></li>
<li class="toctree-l1"><a class="reference internal" href="170_TellDoNotAsk.html"><span class="xref myst">Raccontare, non chiedere</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="180_Web_of_objects_explained.html">La necessità degli oggetti mock</a></li>
<li class="toctree-l1"><a class="reference internal" href="190_Why_do_we_need_composability.html">Perché abbiamo bisogno della componibilità?</a></li>
<li class="toctree-l1"><a class="reference internal" href="200_What_does_it_mean_to_compose_objects.html">Reti, messaggi e protocolli</a></li>
<li class="toctree-l1"><a class="reference internal" href="210_How_are_objects_composed.html">Comporre una rete di oggetti</a></li>
<li class="toctree-l1"><a class="reference internal" href="211_When_are_objects_composed.html">Quando vengono composti gli oggetti?</a></li>
<li class="toctree-l1"><a class="reference internal" href="212_How_are_the_connections_made.html">Come fa un mittente ad ottenere un riferimento a un destinatario (cioè come vengono stabilite le connessioni)?</a></li>
<li class="toctree-l1"><a class="reference internal" href="213_Where_are_objects_composed.html">Dove vengono composti gli oggetti?</a></li>
<li class="toctree-l1"><a class="reference internal" href="220_Designing_for_composabiity_interfaces.html">Interfacce</a></li>
<li class="toctree-l1"><a class="reference internal" href="230_Designing_for_composabiity_protocols.html">Protocolli</a></li>
<li class="toctree-l1"><a class="reference internal" href="235_Classes.html">Le Classi</a></li>
<li class="toctree-l1"><a class="reference internal" href="240_Refactoring_Object_Composition.html">Composizione di Oggetti come Linguaggio</a></li>
<li class="toctree-l1"><a class="reference internal" href="250_Value_Objects.html">Gli <em>Oggetti Valore</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="255_Value_Objects_properties.html">Anatomia del <em>oggetto valore</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="257_Value%20objects_general_topics.html">Aspetti del design degli <em>oggetti valore</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="259_DataTransferObjects.html">Oggetti di Trasferimento Dati</a></li>
<li class="toctree-l1"><a class="reference internal" href="259_DataTransferObjects.html#decoupling-by-abstracting-behavior">Disaccoppiamento mediante l'astrazione del comportamento</a></li>
<li class="toctree-l1"><a class="reference internal" href="259_DataTransferObjects.html#decoupling-by-abstracting-data">Disaccoppiamento mediante l'astrazione dei dati</a></li>
<li class="toctree-l1"><a class="reference internal" href="259_DataTransferObjects.html#use-both">Usare entrambi</a></li>
<li class="toctree-l1"><a class="reference internal" href="259_DataTransferObjects.html#dto-as-data-centric-decoupling-mechanism">DTO come meccanismo di disaccoppiamento incentrato sui dati</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parte 3:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="260_Part3Marker.html">Parte 3: TDD nel Mondo Object-Oriented</a></li>
<li class="toctree-l1"><a class="reference internal" href="270_Mock_Objects.html">Oggetti Mock come strumento di test</a></li>
<li class="toctree-l1"><a class="reference internal" href="280_Start_with_a_failing_test_mocks.html">Test-first  [<em>Testare prima</em>] utilizzando oggetti mock</a></li>
<li class="toctree-l1"><a class="reference internal" href="290_NeedDrivenDevelopment.html">Il test-driving ai confini di input</a></li>
<li class="toctree-l1"><a class="reference internal" href="300_NeedDrivenRetrospective1.html">Il test-driving ai confini di input -- una retrospettiva</a></li>
<li class="toctree-l1"><a class="reference internal" href="310_Test_Driving_Factories.html">Creazione di oggetti &quot;test-driving&quot;</a></li>
<li class="toctree-l1"><a class="reference internal" href="320_Test_Driving_Factories_retrospective.html">Creazione di oggetti &quot;test-driving&quot; -- una retrospettiva</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Logica dell'applicazione test-driving</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#summary">Riepilogo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="340_Test-Driving_Value_object.html"><em>Oggetti valore</em> nel test-driving</a></li>
<li class="toctree-l1"><a class="reference internal" href="350_Web_of_objects_boundaries.html">Raggiungere la rete dei confini degli oggetti</a></li>
<li class="toctree-l1"><a class="reference internal" href="360_Internals.html">Cosa c'è dentro l'oggetto?</a></li>
<li class="toctree-l1"><a class="reference internal" href="370_Design_smells.html">Odori del design visibile nella Specifica</a></li>
<li class="toctree-l1"><a class="reference internal" href="End.html">QUESTO È TUTTO QUELLO CHE HO PER ORA. QUELLO CHE SEGUE È MATERIALE GREZZO, NON ORDINATO, NON ANCORA PRONTO PER ESSERE CONSUMATO COME PARTE DI QUESTO TUTORIAL</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parte 5:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html">Mock di oggetti come strumento di progettazione</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#guidance-of-test-smells">Guidaa ai test smells [<em>puzzolenti</em>]</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#revisiting-topics-from-chapter-1">Rivedere gli argomenti del capitolo 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#maintainable-mock-based-statements">Statement manutenibili basate su mock</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#refactoring-mock-code">Refactoring del codice mock</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#part-4-application-architecture">Parte 4: Architettura dell'applicazione</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#on-stable-architectural-boundaries">Sui confini stabili/architetturali</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#ports-and-adapters">[Port] e adapter</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#what-goes-into-application">Cosa entra in applicazione?</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#what-goes-into-ports">Cosa va nei [port]?</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#part-5-tdd-on-application-architecture-level">Parte 5: TDD a livello di architettura applicativa</a></li>
<li class="toctree-l1"><a class="reference internal" href="400_Dealing_with_3rd_party.html#designing-automation-layer">Progettazione del layer di automazione</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parte 9:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="990_Further_reading.html"><span class="xref myst">Ulteriori Letture</span></a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="320_Test_Driving_Factories_retrospective.html" title="capitolo precedente">Creazione di oggetti &quot;test-driving&quot; -- una retrospettiva</a></li>
      <li>Next: <a href="340_Test-Driving_Value_object.html" title="capitolo successivo"><em>Oggetti valore</em> nel test-driving</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Ricerca veloce</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Vai" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Grzegorz GaÅ‚Ä™zowski.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/manuscript/330_Test-Driving_Command.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>